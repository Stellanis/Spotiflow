version: '3.8'

services:
  # --- Spotiflow Backend ---
  backend:
    container_name: spotiflow_backend
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-UTC}
      - LASTFM_API_KEY=${LASTFM_API_KEY}
      - LASTFM_API_SECRET=${LASTFM_API_SECRET}
      - LASTFM_USER=${LASTFM_USER}
    ports:
      - "8000:8000"
    volumes:
      - type: bind
        source: ${HOST_MUSIC_PATH}
        target: /app/downloads
        bind:
          create_host_path: true
      - type: bind
        source: ${HOST_DATA_PATH}
        target: /app/data
        bind:
          create_host_path: true
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: "512M"
        reservations:
          memory: "128M"

  # --- Spotiflow Frontend ---
  frontend:
    container_name: spotiflow_frontend
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3001:80"
    depends_on:
      - backend
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: "256M"
        reservations:
          memory: "64M"
